# Lab giao thức iSCSI## Mô hình Gồm 2 máy hệ điều hành centos7:- Server : 	+ Cài đặt target 	+ Có thêm 2 ổ cứng là sdb và sdc. Mỗi ổ có dung lượng là 2GB- Client : 	+ Cài đặt initiatorHình vẽ mô tả: <img src="http://i.imgur.com/yFuz50t.png">## Cài đặt### Trên máy server- Bước 1: Cài iSCSI Target ```shyum -y install epel-releaseyum  -y install scsi-target-utils```- Bước 2: Chỉnh sửa file cấu hình /etc/tgt/targets.conf. Thêm những dòng sau vào cuối file```sh<target iqn.2017-05.kma.vn:target01>  // tên thẻ và tên miền backing-store /dev/sdb  initiator-address 192.168.76.161 // địa chỉ của máy clientincominguser root minhkma  // tên đăng nhập và mật khẩu login vào server</target><target iqn.2017-05.kma.vn:target02>backing-store /dev/sdcinitiator-address 192.168.76.161incominguser root minhkma</target>```- Bước 3: Mở port trong filewall```shfirewall-cmd --add-service=iscsi-target --permanent firewall-cmd --reload ```- Bước 4: Khởi động dịch vụ```shsystemctl start tgtdsystemctl enable tgtd ```Xác thực lại trạng thái cấp storage``tgtadm --mode target --op show``## Trên máy client- Bước 1: Cài đặt dịch vụ iscsi-initiator``yum install iscsi-initiator-utils -y``- Bước 2: Sửa lại file ``/etc/iscsi/initiatorname.iscsi````InitiatorName=iqn.2017-05.kma.vn:initiator``- Bước 3: Sửa lại file ``/etc/iscsi/iscsid.conf`````shBỏ comment dòng 57node.session.auth.authmethod = CHAPThiết lập tên đăng nhập và passwordnode.session.auth.username = rootnode.session.auth.password = minhkma- Bước 4: Tìm ISCSI-Target``iscsiadm -m discovery -t sendtargets -p 192.168.76.160``- Bước 5: Đăng nhập vào máy ISCSI-Target``iscsiadm -m node --login`````sh[root@localhost ~]# iscsiadm -m node --loginLogging in to [iface: default, target: iqn.2017-05.kma.vn:target01, portal: 192.168.76.160,3260] (multiple)Logging in to [iface: default, target: iqn.2017-05.kma.vn:target02, portal: 192.168.76.160,3260] (multiple)Login to [iface: default, target: iqn.2017-05.kma.vn:target01, portal: 192.168.76.160,3260] successful.Login to [iface: default, target: iqn.2017-05.kma.vn:target02, portal: 192.168.76.160,3260] successful.```- Bước 6: kiểm tra ```sh[root@localhost ~]# lsblkNAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTsda           8:0    0   20G  0 disk├─sda1        8:1    0    1G  0 part /boot└─sda2        8:2    0   19G  0 part  ├─cl-root 253:0    0   17G  0 lvm  /  └─cl-swap 253:1    0    2G  0 lvm  [SWAP]sdb           8:16   0    2G  0 disksdc           8:32   0    2G  0 disksr0          11:0    1  680M  0 rom```Chúng ta đã thấy client đã kết nối được đến ổ sdb và sdc của máy server.